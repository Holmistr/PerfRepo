<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:c="http://java.sun.com/jstl/core"
	xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:r="http://richfaces.org">
<h:body>
	<f:metadata>
		<f:event type="preRenderView" listener="#{searchController.preRender}" />
	</f:metadata>
	<ui:composition template="/layout/template.xhtml">
		<ui:define name="compareAddAll">
			<li><r:commandLink value=" " alt="Add all current results" title="Add all current results"
					action="#{searchController.addAllCurrentResultsToComparison()}" render="compareMenuItem :messagesPanel">
					<i class="icon-copy"></i>
				</r:commandLink></li>
		</ui:define>
		<ui:define name="head">
			<link href="/repo/rfRes/datatable.ecss.jsf?ln=org.richfaces" rel="stylesheet" type="text/css"></link>
		</ui:define>
		<ui:define name="title">Search Test Execution</ui:define>
		<ui:define name="content">
			<h:form id="criteriaForm" class="form-horizontal well">
				<fieldset>
					<legend>Search Test Execution</legend>
					<div class="control-group">
						<h:outputLabel class="control-label" for="testName">Test Name</h:outputLabel>
						<div class="controls">
							<h:inputText type="text" class="input-xlarge" id="testName" value="#{searchController.criteria.testName}" />
						</div>
					</div>

					<div class="control-group">
						<h:outputLabel class="control-label" for="testUID">Test UID</h:outputLabel>
						<div class="controls">
							<h:inputText class="input-xlarge" id="testUID" value="#{searchController.criteria.testUID}" />
						</div>
					</div>

					<div class="control-group">
						<h:outputLabel class="control-label" for="testStartedFrom">Test started from</h:outputLabel>
						<div class="controls">
							<r:calendar value="#{searchController.criteria.startedFrom}" datePattern="yyyy-MM-dd HH:mm" id="testStartedFrom" />
						</div>
					</div>

					<div class="control-group">
						<h:outputLabel class="control-label" for="testStartedTo">Test started to</h:outputLabel>
						<div class="controls">
							<r:calendar value="#{searchController.criteria.startedTo}" datePattern="yyyy-MM-dd HH:mm" id="testStartedTo" />
						</div>
					</div>

					<div class="control-group">
						<h:outputLabel class="control-label" for="tags">Tags</h:outputLabel>
						<div class="controls">
							<h:inputText class="input-xlarge" id="tags" value="#{searchController.criteria.tags}" />
						</div>
					</div>

					<h:panelGroup rendered="#{searchController.criteria.parameters.isEmpty()}">
						<div class="control-group">
							<h:outputLabel class="control-label">Parameters</h:outputLabel>
							<div class="controls">
								<r:commandLink styleClass="btn btn-primary btn-small" render="@form" alt="Add parameter criteria" title="Add parameter criteria"
									action="#{searchController.addParameterCriteria}">
									<i class="icon-plus"></i>
								</r:commandLink>
							</div>
						</div>
					</h:panelGroup>
					<h:panelGroup rendered="#{!searchController.criteria.parameters.isEmpty()}">
						<div class="control-group">
							<h:outputLabel class="control-label">Parameters</h:outputLabel>
							<div class="controls">
								<h:dataTable value="#{searchController.criteria.parameters}" var="item">
									<h:column>
										<f:facet name="header">Name</f:facet>
										<h:inputText class="input-xlarge" value="#{item.name}" />
									</h:column>
									<h:column>
										<f:facet name="header">Value</f:facet>
										<h:inputText class="input-xlarge" value="#{item.value}" />
									</h:column>
									<h:column>
										<f:facet name="header">
											<r:commandLink styleClass="btn btn-primary btn-small" render="@form" alt="Add parameter criteria" title="Add parameter criteria"
												action="#{searchController.addParameterCriteria}">
												<i class="icon-plus"></i>
											</r:commandLink>
										</f:facet>
										<r:commandLink styleClass="btn btn-primary btn-small" render="@form" alt="Remove" title="Remove"
											action="#{searchController.removeParameterCriteria(item)}">
											<i class="icon-trash"></i>
										</r:commandLink>
									</h:column>
								</h:dataTable>
							</div>
						</div>
					</h:panelGroup>
					<div class="control-group">
						<h:outputLabel class="control-label" for="tags">Additional columns</h:outputLabel>
						<div class="controls">
							<h:selectManyListbox value="#{searchController.extraColumns}">
								<f:selectItem itemValue="execId" itemLabel="Execution Id" />
								<f:selectItem itemValue="tags" itemLabel="Tags" />
							</h:selectManyListbox>
						</div>
					</div>
				</fieldset>

				<div class="form-actions">
					<r:commandButton action="#{searchController.search}" value="Search" styleClass="btn btn-primary" alt="Search Test Execution" title="Search Test Execution"
						render="@form :searchResult :messagesPanel">
						<f:param name="testExecutionSearchTO" value="#{searchController.criteria}" />
					</r:commandButton>
				</div>
			</h:form>

			<h:form id="searchResult">
				<table class="rf-dt searchResult">
					<thead class="rf-dt-thd">
						<tr class="rf-dt-shdr">
							<c:if test="#{searchController.isDisplayColumn('execId')}">
								<th class="rf-dt-shdr-c"><r:commandLink value="ID" render="@form :searchResult :messagesPanel" action="#{searchController.sortBy('id', false)}" /></th>
							</c:if>
							<th class="rf-dt-shdr-c"><r:commandLink value="Name" render="@form :searchResult :messagesPanel" action="#{searchController.sortBy('name', false)}" /></th>
							<th class="rf-dt-shdr-c"><r:commandLink value="Time" render="@form :searchResult :messagesPanel"
									action="#{searchController.sortBy('started', false)}" /></th>
							<c:if test="#{searchController.isDisplayColumn('tags')}">
								<th class="rf-dt-shdr-c">Tags</th>
							</c:if>
							<ui:repeat value="#{searchController.paramColumns}" var="item">
								<th class="rf-dt-shdr-c"><r:commandLink value="#{item}" render="@form :searchResult :messagesPanel"
										action="#{searchController.sortBy(item, false)}" /> - <r:commandLink value="#" render="@form :searchResult :messagesPanel"
										action="#{searchController.sortBy(item, true)}" /></th>
							</ui:repeat>
							<th class="rf-dt-shdr-c">Commands</th>
						</tr>
					</thead>
					<tbody class="rf-dt-b">
						<ui:repeat value="#{searchController.result}" var="item">
							<tr class="rf-dt-r rf-dt-fst-r" id="line-#{item.id}">
								<c:if test="#{searchController.isDisplayColumn('execId')}">
									<td class="rf-dt-c">#{item.id}</td>
								</c:if>
								<td class="rf-dt-c"><a href="/repo/exec/#{item.id}">#{item.name}</a></td>
								<td class="rf-dt-c"><h:outputText value="#{item.started}">
										<f:convertDateTime pattern="dd.MM.yyyy HH:mm" timeStyle="full" />
									</h:outputText></td>
								<c:if test="#{searchController.isDisplayColumn('tags')}">
									<td class="rf-dt-c"><ui:repeat value="#{item.sortedTags}" var="item2">
								 #{item2}
									</ui:repeat></td>
								</c:if>
								<ui:repeat value="#{searchController.paramColumns}" var="item2">
									<td class="rf-dt-c"><h:outputText value="#{searchController.itemParam(item, item2)}" escape="false" /></td>
								</ui:repeat>
								<td class="rf-dt-c"><div class="btn-group">
										<r:commandLink styleClass="btn btn-primary btn-small" action="#{searchController.delete}" alt="#{strings.delete}" title="#{strings.delete}"
											render="@form :criteriaForm :messagesPanel"
											onclick="if (!confirm('Are you sure you want to delete the test execution (#{item.name})?') ) { return false;}; return true;">
											<f:param name="idToDelete" value="#{item.id}" />
											<i class="icon-trash"></i>
										</r:commandLink>
										<r:commandLink styleClass="btn btn-primary btn-small" render=":compareMenuItem" lt="Add to comparison" title="Add to comparison"
											action="#{teComparatorSession.add(item.id)}">
											<i class="icon-plus"></i>
										</r:commandLink>
									</div></td>
							</tr>
							<r:tooltip target="line-#{item.id}" followMouse="false" direction="topLeft">
								<span><b>ID:</b> #{item.id}<br /> <b>Test name:</b> <a href="/repo/test/#{item.test.id}">#{item.test.name}</a><br /> <b>Comment:</b><br /> <h:outputText
										value="#{item.comment}" escape="false" /> </span>
							</r:tooltip>
						</ui:repeat>
					</tbody>
				</table>
			</h:form>
		</ui:define>
	</ui:composition>
</h:body>
</html>