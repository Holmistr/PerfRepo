<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:c="http://java.sun.com/jstl/core"
	xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:rich="http://richfaces.org/rich" xmlns:a4j="http://richfaces.org/a4j"
	xmlns:jsflot="http://www.jsflot.org/taglib/jsflot">
<h:body>
	<f:metadata>
		<f:event type="preRenderComponent" listener="#{compareExecutionsController.preRender}" />
	</f:metadata>
	<ui:composition template="/layout/template.xhtml">
		<ui:define name="head">
			<jsflot:resources />
		</ui:define>
		<ui:define name="title">Compare test executions</ui:define>
		<ui:define name="content">
			<h1>Compare Test Executions</h1>
			<h:form>
				<p>
					Executions for test <a href="/repo/test/#{compareExecutionsController.test.id}">#{compareExecutionsController.test.name}</a>
				</p>
				<p>
					<a class="btn btn-primary" href="/repo/reports/compare/param">Compare parameters</a>
				</p>
				<h2>Test executions</h2>
				<rich:dataTable id="teTable" value="#{compareExecutionsController.testExecutions}" var="te" styleClass="tetable">

					<rich:column sortable="true" sortOrder="#{compareExecutionsController.sortsOrders['id']}" sortBy="#{te.id}" width="100px"
						styleClass="#{compareExecutionsController.isBaseline(te.id) ? 'compare_exec_baseline' : '' }">
						<f:facet name="header">
							<a4j:commandLink value="Id" render="teTable" action="#{compareExecutionsController.sort()}">
								<f:param name="sortProperty" value="id" />
								<f:ajax render="teTable" />
							</a4j:commandLink>
						</f:facet>
						<h:outputText value="#{te.id}" />
					</rich:column>

					<rich:column sortable="true" sortOrder="#{compareExecutionsController.sortsOrders['name']}" sortBy="#{te.name}" width="200px"
						styleClass="#{compareExecutionsController.isBaseline(te.id) ? 'compare_exec_baseline' : '' }">
						<f:facet name="header">
							<a4j:commandLink value="Name" render="teTable" action="#{compareExecutionsController.sort()}">
								<f:param name="sortProperty" value="name" />
								<f:ajax render="teTable" />
							</a4j:commandLink>
						</f:facet>
						<a href="/repo/exec/#{te.id}"><h:outputText value="#{te.name}" /></a>
					</rich:column>

					<rich:column sortable="true" sortOrder="#{compareExecutionsController.sortsOrders['started']}" sortBy="#{te.started}" width="200px"
						styleClass="#{compareExecutionsController.isBaseline(te.id) ? 'compare_exec_baseline' : '' }">
						<f:facet name="header">
							<a4j:commandLink value="Test Execution Date" render="teTable" action="#{compareExecutionsController.sort()}">
								<f:param name="sortProperty" value="started" />
								<f:ajax render="teTable" />
							</a4j:commandLink>
						</f:facet>
						<h:outputText value="#{te.started}" />
					</rich:column>
					<rich:column width="600px" styleClass="#{compareExecutionsController.isBaseline(te.id) ? 'compare_exec_baseline' : '' }">
						<f:facet name="header">
							Tags
						</f:facet>
						<h:outputText value="#{compareExecutionsController.getTags(te)}" />
					</rich:column>
					<rich:column styleClass="#{compareExecutionsController.isBaseline(te.id) ? 'compare_exec_baseline' : '' }">
						<f:facet name="header"></f:facet>
						<h:commandLink styleClass="btn btn-primary btn-small" action="#{compareExecutionsController.setAsBaseline(te.id)}" alt="Set as baseline"
							title="Set as baseline">
							<i class="icon-compass "></i>
						</h:commandLink>
						<h:commandLink styleClass="btn btn-primary btn-small" action="#{compareExecutionsController.removeFromComparison(te.id)}" alt="Remove from comparison"
							title="Remove from comparison">
							<i class="icon-trash"></i>
						</h:commandLink>
					</rich:column>
				</rich:dataTable>
			</h:form>

			<h:form>
				<h2>Test execution values</h2>
				<table class="rf-dt tetable_values">
					<thead class="rf-dt-thd">
						<tr class="rf-dt-shdr">
							<th class="rf-dt-shdr-c">Metric \ Execution</th>
							<ui:repeat value="#{compareExecutionsController.testExecutions}" var="exec">
								<th class="rf-dt-shdr-c">#{exec.name}</th>
							</ui:repeat>
						</tr>
					</thead>
					<tbody class="rf-dt-b">
						<ui:repeat value="#{compareExecutionsController.metrics}" var="metric">
							<tr class="rf-dt-r rf-dt-fst-r">
								<td class="rf-dt-c"><h:commandLink value="#{metric.name}" action="#{compareExecutionsController.createChart(metric.id, false)}"
										title="Compute chart" /></td>
								<ui:repeat value="#{compareExecutionsController.testExecutions}" var="exec">
									<td class="rf-dt-c #{compareExecutionsController.isBaseline(exec.id) ? 'compare_exec_baseline' : '' }">#{compareExecutionsController.getMetricValue(exec.id,
										metric.id)}</td>
								</ui:repeat>
							</tr>
						</ui:repeat>
					</tbody>
				</table>

				<h:panelGroup rendered="#{compareExecutionsController.baselineExecution != null}">
					<h2>Comparison with baseline</h2>
					<table class="rf-dt tetable_values">
						<thead class="rf-dt-thd">
							<tr class="rf-dt-shdr">
								<th class="rf-dt-shdr-c">Metric \ Execution</th>
								<ui:repeat value="#{compareExecutionsController.testExecutions}" var="exec">
									<th class="rf-dt-shdr-c">#{exec.name}</th>
								</ui:repeat>
							</tr>
						</thead>
						<tbody class="rf-dt-b">
							<ui:repeat value="#{compareExecutionsController.metrics}" var="metric">
								<tr class="rf-dt-r rf-dt-fst-r">
									<td class="rf-dt-c"><h:commandLink value="#{metric.name}" action="#{compareExecutionsController.createChart(metric.id, true)}"
											title="Compute chart" /></td>
									<ui:repeat value="#{compareExecutionsController.testExecutions}" var="exec">
										<td class="rf-dt-c #{compareExecutionsController.isBaseline(exec.id) ? 'compare_exec_baseline' : '' }">#{compareExecutionsController.getMetricValueBaselineCompared(exec.id,
											metric.id)}</td>
									</ui:repeat>
								</tr>
							</ui:repeat>
						</tbody>
					</table>
				</h:panelGroup>
			</h:form>

			<h:panelGroup id="chartPanelContainer">
				<h:panelGroup id="chartPanel" rendered="#{compareExecutionsController.chart != null}">
					<h:form>
						<script type="text/javascript">
            $.noConflict();
         </script>
						<jsflot:flotChart id="execComparisonChart" value="#{compareExecutionsController.chartData}" height="320" width="640" mode="Series"
							title="Compare test executions" chartType="bar" showTooltip="true" yaxisMinValue="#{compareExecutionsController.chart.yaxisMinValue}"
							yaxisMaxValue="#{compareExecutionsController.chart.yaxisMaxValue}" showXaxisLabels="false" showLines="false">
						</jsflot:flotChart>
					</h:form>
				</h:panelGroup>
			</h:panelGroup>

		</ui:define>
	</ui:composition>
</h:body>
</html>
