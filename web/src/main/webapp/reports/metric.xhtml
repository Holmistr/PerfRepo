<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:c="http://java.sun.com/jstl/core"
	xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:rich="http://richfaces.org/rich" xmlns:a4j="http://richfaces.org/a4j"
	xmlns:jsflot="http://www.jsflot.org/taglib/jsflot">
<h:body>

	<f:metadata>
		<f:viewParam name="t" value="#{metricReportBean.testUid}" />
		<f:viewParam name="p" value="#{metricReportBean.parameterName}" />
		<f:viewParam name="m" value="#{metricReportBean.metricName}" />
		<f:viewParam name="tags" value="#{metricReportBean.tags}" />
		<f:event type="preRenderView" listener="#{metricReportBean.preRender}" />
	</f:metadata>
	<ui:composition template="/layout/commonLayoutCharting.xhtml">
		<ui:define name="title">Metric values</ui:define>
		<ui:define name="content">
			<h1>Metric report</h1>
			<h2>Parameters</h2>
			<table id="params">
				<tr>
					<td><h:outputText value="#{entityStrings.Test_uid}" /></td>
					<td><h:selectOneMenu value="#{metricReportBean.selectedTest}" rendered="#{!metricReportBean.testUidDisabled}">
							<f:selectItems styleClass="input-text" value="#{metricReportBean.selectionTests}" var="item" itemLabel="#{item.uid}" itemValue="#{item.id}" />
						</h:selectOneMenu> <h:outputText value="#{metricReportBean.selectedTest.uid}" rendered="#{metricReportBean.testUidDisabled}" /></td>
				</tr>
				<tr>
					<td><h:outputText value="#{entityStrings.Metric_metricName}" /></td>
					<td><h:selectOneMenu value="#{metricReportBean.selectedMetric}" rendered="#{!metricReportBean.metricDisabled}">
							<f:selectItems styleClass="input-text" value="#{metricReportBean.selectionMetrics}" var="item" itemLabel="#{item.name}" itemValue="#{item.id}" />
						</h:selectOneMenu> <h:outputText value="#{metricReportBean.selectedMetric.name}" rendered="#{metricReportBean.metricDisabled}" /></td>
				</tr>
				<tr>
					<td><h:outputText value="#{entityStrings.TestExecutionParameter_paramName}" /></td>
					<td><h:selectOneMenu value="#{metricReportBean.selectedParam}" rendered="#{!metricReportBean.execParameterDisabled}">
							<f:selectItems styleClass="input-text" value="#{metricReportBean.selectionParams}" var="item" itemLabel="#{item}" itemValue="#{item}" />
						</h:selectOneMenu> <h:outputText value="#{metricReportBean.selectedParam}" rendered="#{metricReportBean.execParameterDisabled}" /></td>
				</tr>
				<tr>
					<td><h:outputText value="#{strings.Tags}" /></td>
					<td><h:inputText styleClass="input-text" value="#{metricReportBean.tags}" /></td>
				</tr>
			</table>
			<h:form id="chartForm" rendered="#{metricReportBean.chartVisible}">
				<script type="text/javascript">
            $.noConflict();
            </script>

				<h:panelGroup id="chartPanel">
					<h2>Chart</h2>
					<jsflot:flotChart id="metricChart" value="#{metricReportBean.chartData}" height="320" width="640" mode="Series" title="#{strings.metricReport_chartTitle}"
						chartType="line" showTooltip="true" yaxisMinValue="#{metricReportBean.chart.yaxisMinValue}" yaxisMaxValue="#{metricReportBean.chart.yaxisMaxValue}"
						showXaxisLabels="true" tooltipFollowMouse="true">
					</jsflot:flotChart>
				</h:panelGroup>
			</h:form>

			<h2>Statistics</h2>
			<table id="stats">
				<tr>
					<td><h:outputText value="#{strings.metricReport_minValue}" /></td>
					<td><h:outputText value="#{metricReportBean.minValue}" /></td>
				</tr>
				<tr>
					<td><h:outputText value="#{strings.metricReport_maxValue}" /></td>
					<td><h:outputText value="#{metricReportBean.maxValue}" /></td>
				</tr>
				<tr>
					<td><h:outputText value="#{strings.metricReport_range}" /></td>
					<td><h:outputText value="#{metricReportBean.range}" /></td>
				</tr>
			</table>

			<h:form id="problemPointsForm" rendered="#{metricReportBean.problematicDataPointsVisible}">
				<h2>Problematic data points</h2>
				<rich:dataTable id="problemPointsTable" styleClass="table" rowClasses="table-row"
					columnClasses="common-column,common-column,common-column,common-column,button-column" headerClass="table-header" footerClass="table-footer"
					value="#{metricReportBean.problematicDatapoints}" var="item" cellspacing="0" cellpadding="0">


					<rich:column sortable="true" sortOrder="#{metricReportBean.sortsOrders['paramValue']}" sortBy="#{item}">
						<f:facet name="header">
							<a4j:commandLink value="#{strings.ProblematicPoints_ParameterValue}" render="problemPointsTable" action="#{metricReportBean.sort()}">
								<f:param name="sortProperty" value="paramValue" />
								<f:ajax render="problemPointsTable" />
							</a4j:commandLink>
						</f:facet>
						<h:outputText value="#{item.param}" />
					</rich:column>

					<rich:column sortable="true" sortOrder="#{metricReportBean.sortsOrders['execId']}" sortBy="#{item}">
						<f:facet name="header">
							<a4j:commandLink value="#{strings.ProblematicPoints_TestExecutionId}" render="problemPointsTable" action="#{metricReportBean.sort()}">
								<f:param name="sortProperty" value="execId" />
								<f:ajax render="problemPointsTable" />
							</a4j:commandLink>
						</f:facet>
						<h:link outcome="TestExecutionDetail">
							<h:outputText value="#{item.execId}" />
							<f:param name="testExecutionId" value="#{item.execId}" />
						</h:link>
					</rich:column>

				</rich:dataTable>
			</h:form>
		</ui:define>
	</ui:composition>
</h:body>
</html>
