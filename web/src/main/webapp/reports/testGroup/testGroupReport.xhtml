<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:a4j="http://richfaces.org/a4j" xmlns:rich="http://richfaces.org/rich" xmlns:r="http://richfaces.org"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

<h:body>
	<f:metadata>
		<f:viewParam name="reportId" value="#{testGroupReportController.reportId}" />
	</f:metadata>
	<ui:composition template="/layout/template.xhtml">
		<ui:define name="title">Report #{testGroupReportController.reportName}</ui:define>
			<ui:define name="content">
			<ui:include src="/reports/testGroup/tests-popup.xhtml" />
			<ui:include src="/reports/testGroup/tags-popup.xhtml" />
			<ui:include src="/reports/testGroup/compare-popup.xhtml" />
			<ui:include src="/reports/testGroup/clone-popup.xhtml" />
			<ui:include src="/reports/testGroup/metric-popup.xhtml" />
			<ui:include src="/reports/report-permissions-add-popup.xhtml" />
			<h:form id="testGroupReport">
				<h1><h:outputText value="#{testGroupReportController.reportName}" rendered="#{testGroupReportController.reportName != null}"/></h1>
				<ui:include src="/reports/report-permission-panel.xhtml" />
				<div id="control" style="text-align: right;line-height: 30px;">
					<span style="margin:5px;">
						<a4j:commandLink styleClass="text-success" action="#{testGroupReportController.setCloning(false)}" rendered="#{testGroupReportController.reportId == null}" oncomplete="#{rich:component('clonePopup')}.show();" alt="Save New Report" title="Save New Report"><i class="icon-copy"/>Save Report</a4j:commandLink>
						<a4j:commandLink styleClass="text-success" action="#{testGroupReportController.setCloning(true)}" rendered="#{testGroupReportController.reportId != null}" oncomplete="#{rich:component('clonePopup')}.show();" alt="Clone Report" title="Clone Report"><i class="icon-copy"/>Clone Report</a4j:commandLink>
					</span>
					<span style="margin:5px;font-weight: bold;"><a4j:commandLink styleClass="text-success" rendered="#{testGroupReportController.reportId != null}" render=":messagesPanel" action="#{testGroupReportController.saveReport()}" alt="Save Report" title="Save Report"><i class="icon-save"/>Save</a4j:commandLink></span>				
				</div>
				<div id="control" style="text-align: right;line-height: 30px;">
					<span style="margin:5px;"><a4j:commandLink render=":testsPopup :testForm" oncomplete="#{rich:component('testsPopup')}.show();" alt="Tests" title="Tests"><i class="icon-list"/>Tests</a4j:commandLink></span>
					<span style="margin:5px;"><a4j:commandLink render=":tagsPopup :tagsForm" oncomplete="#{rich:component('tagsPopup')}.show();" alt="Tags" title="Tags"><i class="icon-tags"/>Tags</a4j:commandLink></span>
					<span style="margin:5px;"><a4j:commandLink render=":comparePopup :compareForm" oncomplete="#{rich:component('comparePopup')}.show();" alt="Compare" title="Compare"><i class="icon-exchange"/>Compare</a4j:commandLink></span>
					<span style="margin:5px;"><a4j:commandLink render=":metricsPopup :metricForm" oncomplete="#{rich:component(':metricsPopup')}.show();" alt="Metric" title="Metric"><i class="icon-list"/>Filter Metrics</a4j:commandLink></span>
					<span style="margin:5px;"><a4j:commandLink oncomplete="#" alt="Threshold" title="Threshold"><i class="icon-certificate"/>Threshold</a4j:commandLink></span>
				</div>
				<table id="testGroupReportTable" class="table table-bordered smallpad">
					<thead>
						<tr>
							<th style="text-align: center; vertical-align: middle">Test</th>
							<th style="text-align: center; vertical-align: middle">Metric</th>
							<ui:repeat value="#{testGroupReportController.tableTags}" var="column">
								<th style="text-align: center; vertical-align: middle">#{column}</th>
							</ui:repeat>
							<ui:repeat value="#{testGroupReportController.comparisonValues}" var="comparisonKey">
								<th>#{comparisonKey}</th>	
						    </ui:repeat>							
						</tr>						
					</thead>
					<tbody>
						<ui:repeat value="#{testGroupReportController.tests}" var="test">
							<tr>
								<td rowspan="#{testGroupReportController.selectedMetrics.size()}">#{test}</td>
								<ui:repeat value="#{testGroupReportController.selectedMetrics}" var="metric" varStatus="status">
									<h:outputText value="#{'&lt;/tr&gt;&lt;tr&gt;'}" rendered="#{status.index > 0}" escape="false" />
									<td>#{metric}</td>
									<ui:repeat value="#{testGroupReportController.tableTags}" var="tag">
										<td>#{testGroupReportController.format(testGroupReportController.getValue(test, tag, metric).bestValue.resultValue)}</td>
									</ui:repeat>
									<ui:repeat value="#{testGroupReportController.comparisonValues}" var="comparisonKey">
										<ui:param name="value" value="#{testGroupReportController.compare(test, comparisonKey, metric)}" />
										<td><span style="color: #{testGroupReportController.getStyle(value)}">#{testGroupReportController.format(value)} %</span></td>
									</ui:repeat>
								</ui:repeat>														
							</tr>
						</ui:repeat>
					</tbody>
				</table>
				<rich:panel id="chart">
				    <ui:repeat value="#{testGroupReportController.selectedMetrics}" var="metric">
						<r:mediaOutput id="chartimg" element="img" cacheable="false" session="true" createContent="#{testGroupChart.drawChart}" mimeType="image/gif" value="#{testGroupReportController.dataset(metric)}"/>
					</ui:repeat>
				</rich:panel>
			</h:form>		
		</ui:define>
	</ui:composition>
</h:body>
</html>